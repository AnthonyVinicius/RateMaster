import{_ as L,r as m,D as A,j as O,c as l,n as $,d as v,e as b,t as d,a as s,u as p,b as h,w as D,p as V,q as N,o as n,k as f,I as x,F as q,m as z,E as G,C as H,f as C,v as J,g as K,H as Q,G as W}from"./index-gYmHc71o.js";const X={key:0,class:"bi bi-check-circle-fill"},Y={key:1,class:"bi bi-exclamation-triangle-fill"},Z={key:2,class:"bi bi-x-circle-fill"},ss={class:"container pt-5"},es={key:0,class:"card p-0 rounded-4 shadow-sm"},ts={class:"row g-0"},as={class:"col bg-light d-flex justify-content-center align-items-center p-5 rounded-start-3"},os=["src","alt"],ls={class:"col bg-white rounded-end-4 p-4"},ns={class:"d-flex flex-column gap-3"},is={class:"d-flex align-items-center"},rs={class:"h2 text-truncate mb-0"},ds={class:"ms-auto me-3"},us={class:"badge bg-warning bg-opacity-25 text-warning p-2 rounded-4"},cs={class:"text-secondary text-truncate mb-0"},ms={class:"text-secondary text-truncate mb-0"},vs={class:"fs-4 fw-bold text-success mb-0"},ps={key:1,class:"mt-5"},bs={class:"mb-3"},gs={class:"mb-4 star-rating"},fs={class:"mb-3"},ys={class:"mt-5"},_s={key:0,class:"mb-5"},hs={key:1,class:"row g-4"},xs={class:"card shadow-sm p-4"},ws={class:"d-flex flex-column gap-4"},ks={class:"d-flex flex-column gap-2"},Ds={class:"d-flex align-items-center gap-1"},Vs={class:"text-warning"},Ss={class:"ms-auto text-secondary"},Rs={class:"text-muted small"},As={class:"mb-0"},Ns={key:0,class:"bg-light rounded-3 p-4 mt-3"},Es={class:"mb-3"},Is={class:"fw-semibold"},Cs={class:"text-muted small mt-1"},Fs={class:"mb-0 text-secondary"},Us={key:1,class:"bg-light rounded-3 p-4 mt-3"},Ts=["onUpdate:modelValue"],js={__name:"ProductDetailsView",setup(Bs){const F=K(),U=Q(),w=m(0),T=new A("products"),S=new A("reviews"),j=new A("shop"),c=W("userData"),r=m(null),u=m([]),i=m({rating:"",comment:""}),y=m({}),E=a=>new Date(a).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}),R=(a,e="success")=>{I.value=a,_.value=e,k.value=!0,setTimeout(()=>k.value=!1,3e3)},I=m(null),_=m("success"),k=m(!1),B=async()=>{try{const a=U.params.id;r.value=await T.get(a),u.value=await S.search("productId",a)||[],u.value.forEach(t=>{y.value[t.id]={comment:""}}),u.value.length>0?w.value=(u.value.reduce((t,o)=>t+o.rating,0)/u.value.length).toFixed(1):w.value=0;const e=await j.get(r.value.idShop);r.value.companyName=e?e.name:"Empresa desconhecida"}catch(a){console.error("Erro ao carregar os detalhes do produto:",a)}},M=async()=>{const a={productId:r.value.id,userId:c.value.id,userName:c.value.name,rating:Number(i.value.rating),comment:i.value.comment,createdAt:new Date().toISOString()};try{await S.insert(a),u.value.unshift(a),w.value=(u.value.reduce((e,t)=>e+t.rating,0)/u.value.length).toFixed(1),i.value.comment="",i.value.rating="",R("Avaliação enviada com sucesso!","success")}catch(e){console.log(c.value),console.error("Erro ao enviar avaliação:",e),R("Ocorreu um erro ao enviar sua avaliação. Tente novamente.","danger")}},P=async(a,e,{resetForm:t})=>{try{const o={userId:c.value.id,userName:c.value.name,comment:y.value[a.id].comment,createdAt:new Date().toISOString()};console.log("Enviando resposta:",o),await S.addResponse(a.id,o),console.log("Resposta enviada com sucesso"),a.responses=a.responses||[],a.responses.push(o),y.value[a.id].comment="",R("Resposta enviada com sucesso!","success"),t()}catch(o){console.error("Erro ao enviar resposta:",o)}};return O(()=>{B()}),(a,e)=>(n(),l(V,null,[k.value?(n(),l("div",{key:0,class:$(`alert alert-${_.value} alert-dismissible fade show custom-alert fixed-bottom m-3`),role:"alert"},[_.value==="success"?(n(),l("i",X)):v("",!0),_.value==="warning"?(n(),l("i",Y)):v("",!0),_.value==="danger"?(n(),l("i",Z)):v("",!0),b(" "+d(I.value)+" ",1),s("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=t=>k.value=!1)})],2)):v("",!0),s("div",ss,[s("button",{type:"button",class:"btn pb-3 back-button",onClick:e[1]||(e[1]=t=>p(F).push("/reviews"))}," ← Voltar para os produtos "),r.value?(n(),l("div",es,[s("div",ts,[s("div",as,[s("img",{src:r.value.image,class:"img-fluid rounded-4",alt:r.value.name,style:{"max-width":"400px"}},null,8,os)]),s("div",ls,[s("div",ns,[s("div",is,[s("h1",rs,d(r.value.name),1),s("div",ds,[s("div",us,[e[8]||(e[8]=s("i",{class:"bi bi-star-fill me-1"},null,-1)),s("span",null,d(w.value),1)])])]),s("p",cs,d(r.value.description),1),s("p",ms,[e[9]||(e[9]=s("i",{class:"bi bi-shop me-1"},null,-1)),b(d(r.value.companyName),1)]),s("p",vs,d(r.value.price),1)])])])])):v("",!0),p(c).userType==="individual"?(n(),l("div",ps,[h(p(C),{onSubmit:M,class:"card p-5 shadow-sm"},{default:D(()=>[e[18]||(e[18]=s("h3",{class:"fw-bold mb-3"},"Deixe sua avaliação",-1)),s("div",bs,[e[15]||(e[15]=s("label",{class:"form-label",for:"rating"},"Sua nota:",-1)),s("div",gs,[f(s("input",{type:"radio",id:"sr-5",name:"star-rating",value:"5","onUpdate:modelValue":e[2]||(e[2]=t=>i.value.rating=t)},null,512),[[x,i.value.rating]]),e[10]||(e[10]=s("label",{for:"sr-5"},[s("i",{class:"bi bi-star-fill"})],-1)),f(s("input",{type:"radio",id:"sr-4",name:"star-rating",value:"4","onUpdate:modelValue":e[3]||(e[3]=t=>i.value.rating=t)},null,512),[[x,i.value.rating]]),e[11]||(e[11]=s("label",{for:"sr-4"},[s("i",{class:"bi bi-star-fill"})],-1)),f(s("input",{type:"radio",id:"sr-3",name:"star-rating",value:"3","onUpdate:modelValue":e[4]||(e[4]=t=>i.value.rating=t)},null,512),[[x,i.value.rating]]),e[12]||(e[12]=s("label",{for:"sr-3"},[s("i",{class:"bi bi-star-fill"})],-1)),f(s("input",{type:"radio",id:"sr-2",name:"star-rating",value:"2","onUpdate:modelValue":e[5]||(e[5]=t=>i.value.rating=t)},null,512),[[x,i.value.rating]]),e[13]||(e[13]=s("label",{for:"sr-2"},[s("i",{class:"bi bi-star-fill"})],-1)),f(s("input",{type:"radio",id:"sr-1",name:"star-rating",value:"1","onUpdate:modelValue":e[6]||(e[6]=t=>i.value.rating=t)},null,512),[[x,i.value.rating]]),e[14]||(e[14]=s("label",{for:"sr-1"},[s("i",{class:"bi bi-star-fill"})],-1))])]),s("div",fs,[e[16]||(e[16]=s("label",{class:"form-label",for:"comment"},"Seu comentário:",-1)),h(p(q),{modelValue:i.value.comment,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value.comment=t),name:"comment",id:"comment",rules:"required|min:5|max:200"},{default:D(({field:t,errors:o,meta:g})=>[s("textarea",z(t,{class:{"form-control":!0,"is-valid":g.touched&&!o.length,"is-invalid":g.touched&&o.length},rows:"4",placeholder:"Compartilhe sua experiência com o produto..."}),null,16)]),_:1},8,["modelValue"]),h(p(G),{name:"comment",class:"invalid-feedback"})]),s("div",null,[h(H,{class:"btn btn-primary shadow-sm"},{default:D(()=>e[17]||(e[17]=[b("Enviar Avaliação")])),_:1})])]),_:1})])):v("",!0),s("div",ys,[e[24]||(e[24]=s("h2",{class:"mb-4 fw-bold"},"Avaliações dos Clientes",-1)),u.value.length===0?(n(),l("div",_s," Ainda não há avaliações para este produto. ")):(n(),l("div",hs,[(n(!0),l(V,null,N(u.value,t=>(n(),l("div",{key:t.id,class:"col-12"},[s("div",xs,[s("div",ws,[s("div",ks,[s("div",Ds,[s("div",Vs,[(n(!0),l(V,null,N(t.rating,o=>(n(),l("i",{class:"bi bi-star-fill",key:o}))),128))]),s("div",Ss,d(t.userName),1)]),s("div",Rs,[e[19]||(e[19]=s("i",{class:"bi bi-clock me-1"},null,-1)),b(" "+d(t.createdAt?E(t.createdAt):"Data não disponível"),1)])]),s("p",As,d(t.comment),1),t.responses&&t.responses.length>0?(n(),l("div",Ns,[e[22]||(e[22]=s("h5",{class:"fw-bold mb-4"},"Respostas da Loja",-1)),(n(!0),l(V,null,N(t.responses,(o,g)=>(n(),l("div",{key:g,class:"bg-white rounded-3 p-3 mb-3 shadow-sm"},[s("div",Es,[s("div",Is,[e[20]||(e[20]=s("i",{class:"bi bi-shop me-2"},null,-1)),b(d(o.userName),1)]),s("div",Cs,[e[21]||(e[21]=s("i",{class:"bi bi-clock me-1"},null,-1)),b(" "+d(o.createdAt?E(o.createdAt):"Data não disponível"),1)])]),s("p",Fs,d(o.comment),1)]))),128))])):v("",!0),p(c).userType==="business"&&t.productId&&r.value.idShop===p(c).id?(n(),l("div",Us,[h(p(C),{onSubmit:o=>P(t,o,{resetForm:a.resetForm})},{default:D(({resetForm:o})=>[f(s("textarea",{"onUpdate:modelValue":g=>y.value[t.id].comment=g,class:"form-control mb-3",rows:"4",placeholder:"Digite sua resposta como loja..."},null,8,Ts),[[J,y.value[t.id].comment]]),e[23]||(e[23]=s("button",{type:"submit",class:"btn btn-primary"},[s("i",{class:"bi bi-reply me-2"}),b("Responder como Loja ")],-1))]),_:2},1032,["onSubmit"])])):v("",!0)])])]))),128))]))])])],64))}},Ps=L(js,[["__scopeId","data-v-09b13033"]]);export{Ps as default};
